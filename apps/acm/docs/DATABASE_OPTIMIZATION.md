# üìã –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è ACM

## üéØ –¶–µ–ª—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è ACM (Access Control Management) —Å–µ—Ä–≤–∏—Å–∞, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –∏–∑ –æ–±—â–µ–π —Å—Ö–µ–º—ã `@iot-hub/shared` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã.

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –£–ª—É—á—à–µ–Ω–∏–µ |
|----------|----------------|-------------------|-----------|
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–±–ª–∏—Ü | 5 | 3 | ‚¨áÔ∏è 40% |
| –°—Ç—Ä–æ–∫ –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ | 130+ | 74 | ‚¨áÔ∏è 43% |
| –ò–Ω–¥–µ–∫—Å—ã | 18 | 11 | ‚¨áÔ∏è 39% |
| –†–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö | –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ | –¢–æ–ª—å–∫–æ ACM | ‚ö° –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ |

## üóÇÔ∏è –¢–∞–±–ª–∏—Ü—ã –≤ ACM —Å–µ—Ä–≤–∏—Å–µ

### ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã (3)

- **users** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã (16 –ø–æ–ª–µ–π + 5 –∏–Ω–¥–µ–∫—Å–æ–≤)
- **organizations** - –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (19 –ø–æ–ª–µ–π + 3 –∏–Ω–¥–µ–∫—Å–∞)
- **groups** - –≥—Ä—É–ø–ø—ã –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö (14 –ø–æ–ª–µ–π + 3 –∏–Ω–¥–µ–∫—Å–∞)

### üö´ –ò—Å–∫–ª—é—á—ë–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (2)

- **devices** - —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ device management —Å–µ—Ä–≤–∏—Å–∞—Ö
- **certificates** - —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ certificate management —Å–µ—Ä–≤–∏—Å–∞—Ö

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. –°–æ–∑–¥–∞–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞

```typescript
// apps/acm/src/infrastructure/database/acm-schema.ts
// –°–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∏–∑ shared
export const usersTable = pgTable('users', { /* ... */ });
export const organizationsTable = pgTable('organizations', { /* ... */ });
export const groupsTable = pgTable('groups', { /* ... */ });
```

### 2. –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Drizzle

```typescript
// apps/acm/drizzle.config.ts
export default defineConfig({
  schema: './src/infrastructure/database/acm-schema.ts', // ACM-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è —Å—Ö–µ–º–∞
  out: './drizzle/migrations',
  schemaFilter: ['public'],
  // ...
});
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω—ã npm —Å–∫—Ä–∏–ø—Ç—ã

```json
{
  "scripts": {
    "db:generate": "node scripts/generate-migrations.cjs",
    "db:migrate": "node scripts/migrate.cjs"
  }
}
```

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ö–µ–º–æ–π

```bash
# 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π —Ç–æ–ª—å–∫–æ –¥–ª—è ACM —Ç–∞–±–ª–∏—Ü
cd apps/acm
npm run db:generate

# 2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
npm run db:migrate

# 3. –ü—Ä—è–º–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
npx drizzle-kit push --config=drizzle.config.ts

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
docker exec iot-postgres psql -U iot_user -d iot_hub -c "\dt"
```

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ë—ã—Å—Ç—Ä–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (–º–µ–Ω—å—à–µ —Ç–∞–±–ª–∏—Ü)
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã —Ç–æ–ª—å–∫–æ –¥–ª—è ACM –æ–ø–µ—Ä–∞—Ü–∏–π
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### üîí –ò–∑–æ–ª—è—Ü–∏—è

- –ò–∑–æ–ª—è—Ü–∏—è –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö
- –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
- –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è

### üì¶ –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- –õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å ACM-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—É—é —Å—Ö–µ–º—É
- –ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –£–ø—Ä–æ—â—ë–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏ –æ—Ç–ª–∞–¥–∫–∞

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ö–µ–º—É

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –∑–∞–ø—É—â–µ–Ω ACM —Å –ø–æ–ª–Ω–æ–π —Å—Ö–µ–º–æ–π:

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ACM —Å–µ—Ä–≤–∏—Å
docker-compose stop acm

# 2. –°–¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
docker exec iot-postgres pg_dump -U iot_user iot_hub > backup.sql

# 3. –û—á–∏—Å—Ç–∏—Ç–µ –±–∞–∑—É (–∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é)
docker exec iot-postgres psql -U iot_user -d iot_hub -c "DROP SCHEMA public CASCADE; CREATE SCHEMA public;"

# 4. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ö–µ–º—É
cd apps/acm
npx drizzle-kit push --config=drizzle.config.ts

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ ACM —Å–µ—Ä–≤–∏—Å
docker-compose up acm
```

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è ACM —Å–µ—Ä–≤–∏—Å–∞ –ø–æ–∑–≤–æ–ª–∏–ª–∞:

- ‚ö° –°–æ–∫—Ä–∞—Ç–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Å—Ö–µ–º—ã –Ω–∞ 40%
- üöÄ –£—Å–∫–æ—Ä–∏—Ç—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
- üîí –û–±–µ—Å–ø–µ—á–∏—Ç—å –∏–∑–æ–ª—è—Ü–∏—é –æ—Ç –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- üì¶ –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É

ACM —Å–µ—Ä–≤–∏—Å —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–∏ —ç—Ç–æ–º —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –æ–±—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π `@iot-hub/shared`.
