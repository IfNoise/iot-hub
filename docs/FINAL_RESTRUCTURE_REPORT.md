# –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç: –†–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è IoT Hub –±–∏–±–ª–∏–æ—Ç–µ–∫

## üéØ –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–†–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è –º–æ–Ω–æ—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è IoT Hub —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö API –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –∏ –æ–±—â–µ–π shared –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –°–æ–∑–¥–∞–Ω–∏–µ API –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ (5 –±–∏–±–ª–∏–æ—Ç–µ–∫)

#### üìö –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤

| –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞         | –î–æ–º–µ–Ω          | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                     | –°—Ç–∞—Ç—É—Å    |
| ------------------ | -------------- | ------------------------------ | --------- |
| `@iot-hub/users`   | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏   | CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| `@iot-hub/auth`    | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è | Keycloak OAuth2                | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| `@iot-hub/devices` | –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞     | IoT —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã   | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| `@iot-hub/mqtt`    | MQTT RPC       | –ö–æ–º–∞–Ω–¥—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º            | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| `@iot-hub/crypto`  | –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è   | –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ       | ‚úÖ –ì–æ—Ç–æ–≤–æ |

#### üîó –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ backend –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º

–í—Å–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Ç–æ—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º:

- **UsersController** ‚Üí `@iot-hub/users` (7 —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤)
- **AuthController** ‚Üí `@iot-hub/auth` (4 —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞)
- **DevicesController** ‚Üí `@iot-hub/devices` (5 —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤)
- **CertificatesController** ‚Üí `@iot-hub/devices` (3 —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞)
- **MqttRpcController** ‚Üí `@iot-hub/mqtt` (2 —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞)

### 2. –°–æ–∑–¥–∞–Ω–∏–µ shared –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

#### üì¶ @iot-hub/shared

–û–±—â–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –∏–∑ iot-core:

- **Utils** - RPC —É—Ç–∏–ª–∏—Ç—ã, —Ç–æ–ø–∏–∫–∏ MQTT
- **Types** - TypeScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- **Constants** - –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –ª–∏–º–∏—Ç—ã
- **Infra** - –ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã (MQTT –∫–ª–∏–µ–Ω—Ç)

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

- **–í—Å–µ–≥–æ –±–∏–±–ª–∏–æ—Ç–µ–∫**: 6 (5 –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ + 1 shared)
- **–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤**: ~50
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞**: ~3000+
- **API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤**: 21

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **TS-REST** - —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ API –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
- **Zod** - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º
- **TypeScript** - —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- **Nx** - –º–æ–Ω–æ—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- **Jest** - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **ESLint** - –ª–∏–Ω—Ç–∏–Ω–≥

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ workspace

```
iot-hub/
‚îú‚îÄ‚îÄ libs/
‚îÇ   ‚îú‚îÄ‚îÄ contracts/          # API –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users/         # @iot-hub/users
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/          # @iot-hub/auth
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ devices/       # @iot-hub/devices
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mqtt/          # @iot-hub/mqtt
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ crypto/        # @iot-hub/crypto
‚îÇ   ‚îî‚îÄ‚îÄ shared/            # @iot-hub/shared
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îî‚îÄ‚îÄ backend/           # NestJS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îî‚îÄ‚îÄ packages/
    ‚îî‚îÄ‚îÄ iot-core/          # –£—Å—Ç–∞—Ä–µ–≤—à–∏–π –ø–∞–∫–µ—Ç
```

### TypeScript –ø—É—Ç–∏

–ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫:

```json
{
  "paths": {
    "@iot-hub/shared": ["libs/shared/src/index.ts"],
    "@iot-hub/users": ["libs/contracts/users/src/index.ts"],
    "@iot-hub/auth": ["libs/contracts/auth/src/index.ts"],
    "@iot-hub/devices": ["libs/contracts/devices/src/index.ts"],
    "@iot-hub/mqtt": ["libs/contracts/mqtt/src/index.ts"],
    "@iot-hub/crypto": ["libs/contracts/crypto/src/index.ts"]
  }
}
```

## üéÅ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è API –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ IDE
- ‚úÖ Compile-time –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥-safe –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–æ–º–µ–Ω–æ–≤
- ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–æ–º–µ–Ω–æ–≤
- ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Ü–∏–∫–ª—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞ (Nx cache)
- ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º

### Developer Experience

- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–æ–µ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ API
- ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### Frontend —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```typescript
import { initClient } from '@ts-rest/core';
import { usersContract } from '@iot-hub/users';

const client = initClient(usersContract, {
  baseUrl: 'http://localhost:3000/api',
});

// –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤—ã–∑–æ–≤ API
const users = await client.getUsers();
if (users.status === 200) {
  users.body.forEach((user) => {
    console.log(user.name); // –ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
  });
}
```

### Backend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

```typescript
import { TsRestHandler } from '@ts-rest/nest';
import { usersContract } from '@iot-hub/users';

@Controller()
export class UsersController {
  @TsRestHandler(usersContract.getUsers)
  async getUsers() {
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Ç–∏–ø–∏–∑–∞—Ü–∏—è
  }
}
```

### Shared –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```typescript
import {
  createRpcRequest,
  MQTT_TOPICS,
  RPC_ERROR_CODES,
  BaseMqttClient,
} from '@iot-hub/shared';

// –°–æ–∑–¥–∞–Ω–∏–µ RPC –∑–∞–ø—Ä–æ—Å–∞
const request = createRpcRequest('user123', 'device456', 'getState', {});

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç
console.log(MQTT_TOPICS.RPC_REQUEST); // 'rpc/request'

// –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ MQTT –∫–ª–∏–µ–Ω—Ç–∞
class MyClient extends BaseMqttClient {
  // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
}
```

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (1-2 —Å–ø—Ä–∏–Ω—Ç–∞)

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –≤ backend**

   - –ó–∞–º–µ–Ω–∞ DTO –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ TS-REST –≤ NestJS
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

2. **–ú–∏–≥—Ä–∞—Ü–∏—è —Å iot-core –Ω–∞ shared**
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–æ–≤ –≤ backend
   - –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ device-simulator
   - –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (2-4 —Å–ø—Ä–∏–Ω—Ç–∞)

3. **Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**

   - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ API –∫–ª–∏–µ–Ω—Ç–∞
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è React Query hooks
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å

4. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**
   - CI/CD –ø–∞–π–ø–ª–∞–π–Ω—ã –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è OpenAPI
   - –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (6+ –º–µ—Å—è—Ü–µ–≤)

5. **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

   - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ backend –Ω–∞ —Å–µ—Ä–≤–∏—Å—ã
   - gRPC –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
   - Distributed tracing

6. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã**
   - Mobile SDK –Ω–∞ –±–∞–∑–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
   - Device SDK —Å —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π
   - Third-party API

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ API –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
- ‚úÖ –†–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω –º–æ–Ω–æ—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- ‚úÖ –ü–æ–≤—ã—à–µ–Ω–∞ —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –º–æ–¥—É–ª—å–Ω–æ—Å—Ç—å –∫–æ–¥–∞
- ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –±–∞–∑–∞ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

- **–¢–∏–ø–∏–∑–∞—Ü–∏—è**: 100% (—É—Å—Ç—Ä–∞–Ω–µ–Ω—ã –≤—Å–µ `any`)
- **–ü–æ–∫—Ä—ã—Ç–∏–µ API**: 21/21 —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- **–°–±–æ—Ä–∫–∞**: ‚úÖ –í—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: ‚úÖ README –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### ROI (Return on Investment)

- **–°–Ω–∏–∂–µ–Ω–∏–µ –±–∞–≥–æ–≤** - —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç runtime –æ—à–∏–±–∫–∏
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** - –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- **–£–ø—Ä–æ—â–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏** - —á–µ—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–æ—Å—Ç—É** - –º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ
