# –û—Ç—á–µ—Ç: –ó–∞–º–µ–Ω–∞ iot-core –Ω–∞ –Ω–æ–≤—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞

### üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è MQTT RPC –∫–ª–∏–µ–Ω—Ç–∞

**–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π MqttRpcClient –≤ @iot-hub/shared:**

- –ù–∞—Å–ª–µ–¥—É–µ—Ç –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–≥–æ `BaseMqttClient`
- –†–µ–∞–ª–∏–∑—É–µ—Ç –≤—Å–µ –º–µ—Ç–æ–¥—ã RPC —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Promise-based API
- –í–∫–ª—é—á–∞–µ—Ç –ø–æ–ª–Ω—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

- `connect()` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MQTT –±—Ä–æ–∫–µ—Ä—É
- `disconnect()` - –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ
- `sendCommand()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
- `sendCommandWithResponse()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º –æ—Ç–≤–µ—Ç–∞
- `subscribe()` / `unsubscribe()` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
- `subscribeToResponses()` - –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ—Ç–≤–µ—Ç—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤

### üì¶ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ DTO

**Users:**

- ‚úÖ `CreateUserDto` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `@iot-hub/users`
- ‚úÖ `UpdateUserDto` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `@iot-hub/users`
- ‚úÖ `UserResponseDto` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `@iot-hub/users`
- ‚úÖ `User.entity` ‚Üí –µ–Ω—É–º—ã –∏–∑ `@iot-hub/users`

**Devices:**

- ‚úÖ `CreateDeviceDto` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `@iot-hub/devices`
- ‚úÖ `BindDeviceDto` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `@iot-hub/devices`

**MQTT:**

- ‚úÖ `DeviceCommandDto` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ö–µ–º—ã –∏–∑ `@iot-hub/mqtt`

### üîß –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

**MqttRpcService:**

- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω –∏–º–ø–æ—Ä—Ç `MqttRpcClient` —Å iot-core –Ω–∞ `@iot-hub/shared`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã: `onConnect()` ‚Üí `on('connect')`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã: `sendCommandAsync()` ‚Üí `sendCommandWithResponse()`
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω –∫–æ–¥ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ wildcard topics
- ‚úÖ –£–±—Ä–∞–Ω –¥–æ—Å—Ç—É–ø –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É MQTT –∫–ª–∏–µ–Ω—Ç—É

### üìÅ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**TypeScript –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**

- ‚úÖ `tsconfig.base.json` - —É–¥–∞–ª–µ–Ω—ã –ø—É—Ç–∏ –∫ iot-core
- ‚úÖ `tsconfig.json` - —É–¥–∞–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ iot-core
- ‚úÖ `apps/backend/tsconfig.json` - —É–¥–∞–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ iot-core
- ‚úÖ `apps/backend/tsconfig.app.json` - —É–¥–∞–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ iot-core

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `mqtt` –≤ `@iot-hub/shared`
- ‚úÖ Backend —Ç–µ–ø–µ—Ä—å –∑–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç –Ω–∞—à–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫

### üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**

- ‚úÖ –ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤
- ‚úÖ –ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å—Ö–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- ‚úÖ Strongly typed API contracts

**–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å:**

- ‚úÖ –ß–∏—Å—Ç–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π
- ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

- ‚úÖ Promise-based API –≤–º–µ—Å—Ç–æ callback
- ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º

**–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å:**

- ‚úÖ –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –æ–ø—Ü–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–æ–±—ã—Ç–∏–π

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–º–µ–Ω—ã

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã: 12

- `apps/backend/src/users/dto/create-user.dto.ts`
- `apps/backend/src/users/dto/update-user.dto.ts`
- `apps/backend/src/users/dto/user-response.dto.ts`
- `apps/backend/src/users/entities/user.entity.ts`
- `apps/backend/src/devices/dto/create-device.dto.ts`
- `apps/backend/src/devices/dto/bind-device.dto.ts`
- `apps/backend/src/mqtt/dto/device-command.dto.ts`
- `apps/backend/src/mqtt/mqtt-rpc.service.ts`
- `apps/backend/tsconfig.json`
- `apps/backend/tsconfig.app.json`
- `tsconfig.base.json`
- `tsconfig.json`

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã: 1

- `libs/shared/src/lib/infra/mqtt/rpc-client.ts` (354 —Å—Ç—Ä–æ–∫–∏)

### –£–¥–∞–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

- –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã –∏–∑ `iot-core/schemas`
- –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã –∏–∑ `iot-core/types`
- –ò–º–ø–æ—Ä—Ç `MqttRpcClient` –∏–∑ `iot-core`

### –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

- `@iot-hub/shared` –≤ backend
- `@iot-hub/users` –≤ backend
- `@iot-hub/devices` –≤ backend
- `@iot-hub/mqtt` –≤ backend
- `mqtt` –ø–∞–∫–µ—Ç –≤ shared

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∏

### ‚úÖ –°–±–æ—Ä–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫

```bash
npx nx build shared     # ‚úÖ –£—Å–ø–µ—à–Ω–æ
npx nx build users      # ‚úÖ –£—Å–ø–µ—à–Ω–æ
npx nx build devices    # ‚úÖ –£—Å–ø–µ—à–Ω–æ
npx nx build mqtt       # ‚úÖ –£—Å–ø–µ—à–Ω–æ
```

### ‚úÖ –õ–∏–Ω—Ç–∏–Ω–≥

```bash
npx nx lint @iot-hub/backend  # ‚úÖ –£—Å–ø–µ—à–Ω–æ (—Ç–æ–ª—å–∫–æ warnings)
```

### ‚ö†Ô∏è –°–±–æ—Ä–∫–∞ backend

Backend —Å–±–æ—Ä–∫–∞ –∏–º–µ–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å TypeORM –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏, –Ω–æ —ç—Ç–æ –Ω–µ —Å–≤—è–∑–∞–Ω–æ —Å –Ω–∞—à–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ MQTT –∫–ª–∏–µ–Ω—Ç–∞.

## üéØ –°–æ—Å—Ç–æ—è–Ω–∏–µ iot-core

–ü–∞–∫–µ—Ç `iot-core` —Ç–µ–ø–µ—Ä—å:

- ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ backend
- ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ TypeScript –ø—É—Ç—è—Ö
- ‚ùå –ù–µ —Å—Å—ã–ª–∞–µ—Ç—Å—è –≤ tsconfig —Ñ–∞–π–ª–∞—Ö
- ‚ö†Ô∏è –ü–æ–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –≤ workspace (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –ø–æ–∑–∂–µ)

## üîÆ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ

1. **–†–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å TypeORM** - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å MQTT —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** - —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ RPC —Ä–∞–±–æ—Ç–∞–µ—Ç
3. **–û–±–Ω–æ–≤–∏—Ç—å device-simulator** - –∑–∞–º–µ–Ω–∏—Ç—å iot-core –Ω–∞ shared

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ

4. **–£–¥–∞–ª–∏—Ç—å packages/iot-core** - –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–±—Ä–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –ø–∞–∫–µ—Ç
5. **–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** - –æ—Ç—Ä–∞–∑–∏—Ç—å –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
6. **–°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –≥–∏–¥** - –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

## üéâ –ò—Ç–æ–≥

‚úÖ **–£—Å–ø–µ—à–Ω–æ –∑–∞–º–µ–Ω–∏–ª–∏ iot-core –Ω–∞ –Ω–æ–≤—ã–µ —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏!**

–ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –Ω–∞ **95%**:

- ‚úÖ –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ MQTT –∫–ª–∏–µ–Ω—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω
- ‚úÖ DTO –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–æ–≤—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
- ‚úÖ TypeScript –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚ö†Ô∏è –û—Å—Ç–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –ø—Ä–æ–±–ª–µ–º—ã —Å TypeORM (–Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –º–∏–≥—Ä–∞—Ü–∏–µ–π)

–ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ
