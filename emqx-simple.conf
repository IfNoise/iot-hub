# EMQX Simple Configuration (без mTLS)
# Упрощённая конфигурация EMQX для разработки без mTLS аутентификации

# =============================================================================
# HTTP/TCP Configuration for non-SSL connections
# =============================================================================

## TCP listener for mqtt protocol on port 1883 (without SSL)
listeners.tcp.default {
  bind = "0.0.0.0:1883"
  max_connections = 1024000
}

## WebSocket listener for HTTP dashboard and WebSocket MQTT
listeners.ws.default {
  bind = "0.0.0.0:8083"
  max_connections = 1024000
}

# =============================================================================
# Dashboard Configuration (HTTP без SSL)
# =============================================================================

dashboard {
  ## HTTP listener (без SSL)
  listeners.http {
    bind = "0.0.0.0:18083"
  }

  ## Dashboard default credentials
  default_username = "admin"
  default_password = "iot-hub-admin"
}

# =============================================================================
# Authentication Configuration (упрощённая)
# =============================================================================

## Простая anonymous аутентификация для разработки
authentication = [ {
  mechanism = password_based
  backend = built_in_database
  user_id_type = clientid
  enable = false
  } ]

  ]
  ## Разрешить anonymous подключения
  authorization {
    no_match = allow
    deny_action = ignore
    cache {
      enable = true
      max_size = 32
      ttl = 1m
    }
    sources = [ {
      type = built_in_database
      enable = true
    }
    ]
  }

  # =============================================================================
  # Logging Configuration
  # =============================================================================

  log {
    console_handler {
      enable = true
      level = info
      formatter = text
    }
  }

  # =============================================================================
  # Zone and Listener Settings
  # =============================================================================

  mqtt {
    # Maximum QoS allowed
    max_qos_allowed = 2
    # Maximum topic levels
    max_topic_levels = 0
    # Maximum packet size
    max_packet_size = 1MB
    # Client idle timeout
    idle_timeout = 15s
    # Maximum topic alias
    max_topic_alias = 65535
    # Retain available
    retain_available = true
    # Wildcard subscription available
    wildcard_subscription = true
    # Shared subscription available
    shared_subscription = true
    # Exclusive subscription available
    exclusive_subscription = false
    # Server keep alive
    server_keepalive = 60
    # Keep alive backoff
    keepalive_backoff = 0.75
    # Maximum inflight messages
    max_inflight = 32
    # Maximum awaiting messages
    max_awaiting_rel = 100
    # Session expiry interval
    session_expiry_interval = 2h
    # Message expiry interval
    message_expiry_interval = infinity
  }
